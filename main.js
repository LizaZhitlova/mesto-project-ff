(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}e.d({},{Q:()=>M});var r,n={baseUrl:"https://nomoreparties.co/v1/wff-cohort-35",headers:{authorization:"cc15c7c0-115a-417c-9697-eca1b1849815","Content-Type":"application/json"}};function o(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var c=function(){return r},a=function(e){return fetch("".concat(n.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:n.headers}).then(o)},u=function(e,t){var r=t?"PUT":"DELETE";return fetch("".concat(n.baseUrl,"/cards/likes/").concat(e),{method:r,headers:n.headers}).then(o)};Promise.all([fetch("".concat(n.baseUrl,"/users/me"),{headers:n.headers}).then(o),fetch("".concat(n.baseUrl,"/cards"),{headers:n.headers}).then(o)]).then((function(e){var n,o,c=(o=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c,a,u=[],i=!0,l=!1;try{if(c=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;i=!1}else for(;!(i=(n=c.call(r)).done)&&(u.push(n.value),u.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{if(!i&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(n,o)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}}(n,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=c[0],u=c[1];console.log("Пользователь:",a),console.log("Карточки:",u),document.querySelector(".profile__title").textContent=a.name,document.querySelector(".profile__description").textContent=a.about,document.querySelector(".profile__image").style.backgroundImage="url('".concat(a.avatar,"')"),r=a._id,M(u)})).catch((function(e){console.error("Ошибка при инициализации:",e)}));var i={inputErrorClass:".type_error",inputErrorSelector:"type_error",errorMassageClass:".popup_input-error_active",errorMassageSelector:"popup_input-error_active",inputSelector:".popup__input",submitButtonSelector:".popup__button",formSelector:".popup__form",submitButtonErrorClass:"popup__button_inactive"};function l(e,t){e.querySelectorAll(t.errorMassageClass).forEach((function(e){e.classList.remove(t.errorMassageSelector),e.textContent=""})),e.querySelectorAll(t.inputErrorClass).forEach((function(e){e.classList.remove(t.inputErrorSelector)}));var r=e.querySelector(t.submitButtonSelector);r.disabled=!0,r.classList.add(t.submitButtonErrorClass)}var s,d=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(i.submitButtonErrorClass)):(t.disabled=!0,t.classList.add(i.submitButtonErrorClass))},p=null;function _(e){e.classList.add("popup_is-opened"),(p=e).addEventListener("click",m),document.addEventListener("keydown",y)}function f(){p.classList.remove("popup_is-opened"),p.removeEventListener("click",m),document.removeEventListener("keydown",y),p=null}function m(e){e.currentTarget===e.target&&f()}function y(e){"Escape"===e.key&&f()}function v(e){var t,r,c;e.preventDefault(),(t=document.querySelector(".popup__input_type_url-avatar").value,r=e.target,c=r.textContent,r.textContent="Сохранение...",fetch("".concat(n.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:n.headers,body:JSON.stringify({avatar:t})}).then(o).finally((function(){setTimeout((function(){r.textContent=c}),1e3)}))).then((function(e){document.querySelector(".profile__image").style.backgroundImage="url('".concat(e.avatar,"')"),document.querySelector(".popup_type_edit-avatar"),f()})).catch((function(e){console.error("Ошибка при загрузке данных:",e),alert("Не удалось обновить аваьар профиля")}))}function S(e){if(e.target.classList.contains("card__delete-button")){var t=e.target.closest(".places__item"),r=(t.querySelector(".card__image").id,document.querySelector(".popup_type_confirm"));b(t),r.querySelector(".popup__button-confirm").addEventListener("click",q),_(r)}}function h(e,t,r){var n=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0);n.querySelector(".card__title").textContent=e.name;var o=n.querySelector(".card__image");return o.src=e.link,o.alt=e.name,o.id=e._id,o.likes=e.likes,c()!==e.owner._id&&n.querySelector(".card__delete-button").classList.add("card__delete-button-hidden"),n.querySelector(".card__likes-number").textContent=e.likes.length,n.querySelector(".card__delete-button").addEventListener("click",t),n.querySelector(".card__image").addEventListener("click",r),n.querySelector(".card__like-button").addEventListener("click",L),g(o.likes)&&E(n.querySelector(".card__like-button"),!0),n}function q(e){var t=s.querySelector(".card__image").id;console.log("delete card"),console.log(t),a(t).then((function(){s.remove(),s=null,f()})).catch((function(e){s=null,console.error("Не удалось удалить карточку:",e)}))}var b=function(e){s=e};function g(e){var t=c();return e.some((function(e){return e._id===t}))}function E(e,t){t&&!e.classList.contains("card__like-button_is-active")?e.classList.add("card__like-button_is-active"):e.classList.remove("card__like-button_is-active")}function L(e){var t=e.target.closest(".places__item"),r=t.querySelector(".card__image"),n=r.id,o=g(r.likes),c=t.querySelector(".card__like-button");u(n,!o).then((function(e){r.likes=e.likes,function(e,t){e.querySelector(".card__likes-number").textContent=t.likes.length}(t,r),E(c,g(e.likes))})).catch((function(e){console.error("Ошибка при обновлении лайка:",e)}))}var k=document.querySelector(".profile__edit-button"),C=document.querySelector(".profile__add-button"),x=document.querySelectorAll(".popup__close"),A=document.querySelectorAll(".popup"),w=document.querySelector('[name ="edit-profile"]'),T=document.querySelector('[name ="new-place"]'),U=document.querySelector(".profile__image");function M(e){e.forEach((function(e){var t=h(e,S,O);document.querySelector(".places__list").append(t)}))}function O(e){if(e.target.classList.contains("card__image")){var t=e.target,r=t.src,n=t.alt,o=document.querySelector(".popup__image");o.src=r,o.alt=n,document.querySelector(".popup__caption").textContent=n,_(document.querySelector(".popup_type_image"))}}T.addEventListener("submit",(function(e){e.preventDefault();var t=e.target,r=t.querySelector(".popup__input_type_card-name"),c=t.querySelector(".popup__input_type_url");(function(e,t,r){var c=r.textContent;return r.textContent="Сохранение...",fetch("".concat(n.baseUrl,"/cards"),{method:"POST",headers:n.headers,body:JSON.stringify({name:e,link:t})}).then(o).finally((function(){setTimeout((function(){r.textContent=c}),1e3)}))})(r.value,c.value,e.target.querySelector(".popup__button")).then((function(e){var t=document.querySelector(".places__list");console.log("add card"),console.log(e._id);var r=h(e,S,O);t.prepend(r),document.querySelector(".popup_type_new-card"),f();var n=document.querySelector('[name ="new-place"]');n.reset(),l(n,i)})).catch((function(e){console.error("Ошибка при создании карточки:",e),alert("Не удалось создать карточку. Проверьте URL изображения и попробуйте снова.")}))})),k.addEventListener("click",(function(e){e.preventDefault();var t=document.querySelector(".profile__title"),r=document.querySelector(".profile__description"),n=document.querySelector(".popup__input_type_name"),o=document.querySelector(".popup__input_type_description");n.value=t.textContent,o.value=r.textContent;var c=document.querySelector(".popup_type_edit");l(document.querySelector('[name ="edit-profile"]'),i),_(c)})),U.addEventListener("click",(function(e){if(e.target.classList.contains("profile__image")){var t=document.querySelector(".popup_type_edit-avatar");t.querySelector(".popup__button-edit-avatar").addEventListener("click",v);var r=t.querySelector('[name ="edit-avatar"]');l(r,i),r.reset(),_(t)}})),C.addEventListener("click",(function(e){e.preventDefault();var t=document.querySelector(".popup_type_new-card"),r=document.querySelector('[name ="new-place"]');r.reset(),l(r,i),_(t)})),x.forEach((function(e){e.addEventListener("click",f)})),A.forEach((function(e){e.classList.add("popup_is-animated")})),w.addEventListener("submit",(function(e){var t=document.querySelector(".popup__input_type_name"),r=document.querySelector(".popup__input_type_description");e.preventDefault(),function(e,t,r){var c=r.textContent;return r.textContent="Сохранение...",fetch("".concat(n.baseUrl,"/users/me"),{method:"PATCH",headers:n.headers,body:JSON.stringify({name:e,about:t})}).then(o).finally((function(){setTimeout((function(){r.textContent=c}),1e3)}))}(t.value,r.value,e.target.querySelector(".popup__button")).then((function(e){var t=document.querySelector(".profile__title"),r=document.querySelector(".profile__description");t.textContent=e.name,r.textContent=e.about})).catch((function(e){console.error("Ошибка при загрузке данных:",e),alert("Не удалось загрузить данные профиля")})),f()})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(i.inputSelector)),r=e.querySelector(i.submitButtonSelector);d(t,r),t.forEach((function(n){n.addEventListener("input",(function(){(function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(i.inputErrorSelector),r.classList.remove(i.errorMassageSelector),r.textContent=""}(e,t):function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add(i.inputErrorSelector),n.textContent=r,n.classList.add(i.errorMassageSelector)}(e,t,t.validationMessage)})(e,n),d(t,r)}))}))}(e)}))}(i)})();